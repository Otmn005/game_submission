<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>UniLife Simulator — RMIT City (Finalist Edition)</title>
<style>
/* ==============================================
   UNI LIFE SIMULATOR - FINALIST EDITION
   Calm mint/sky theme with accessible contrast
   ============================================== */
:root{
  --mint:#d2f6e9;
  --sky:#d6ecff;
  --text:#1a1a1a;
  --accent:#2c7a7b;
  --positive:#16a34a;
  --negative:#ef4444;
}
html,body{margin:0;padding:0;font-family:Inter,system-ui,sans-serif;
  background:linear-gradient(180deg,var(--mint),var(--sky));color:var(--text);}
main{max-width:900px;margin:auto;padding:20px;}
h1,h2,h3{text-align:center;}
button{cursor:pointer;background:var(--accent);color:#fff;border:none;
  padding:10px 16px;border-radius:8px;margin:6px;font-size:1rem;transition:.3s;}
button:hover{opacity:.9;}
#menu,#game,#results{display:none;}
.progress{height:16px;border-radius:8px;overflow:hidden;background:#e5e5e5;margin-bottom:6px;}
.progress span{display:block;height:100%;background:linear-gradient(90deg,#8ee3ff,#b9fbd6);transition:width .4s;}
.stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
#choices button{display:block;width:100%;text-align:left;margin:8px 0;padding:12px;}
.toast{position:fixed;left:50%;bottom:25px;transform:translateX(-50%);
  background:#fff;border:1px solid #ccc;padding:10px 14px;border-radius:12px;
  box-shadow:0 6px 20px rgba(0,0,0,.1);opacity:0;transition:.4s;}
.toast.show{opacity:1;}
#modal-5w,#journal-modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.4);
 display:none;align-items:center;justify-content:center;z-index:99;}
#modal-5w.show,#journal-modal.show{display:flex;}
.modal-content{background:#fff;border-radius:10px;padding:20px;max-width:600px;width:90%;text-align:center;}
canvas{max-width:100%;}
footer{text-align:center;font-size:.9rem;margin:40px 0;color:#333;}
</style>
</head>
<body>
<main>
  <!-- MENU -->
  <section id="menu">
    <h1>UniLife Simulator — RMIT City</h1>
    <p>Balance your wellbeing, study, money and social life across 15 weeks at uni.</p>
    <label>Name: <input id="name" value="Alex"></label><br>
    <label>Major: <input id="major" value="Computer Science"></label><br>
    <label>Pronouns: <input id="pronouns" value="they/them"></label><br><br>
    <label><input type="checkbox" id="mindful-toggle"> Mindful Mode (adds breathing pauses)</label><br><br>
    <button id="start-btn">Start Semester</button>
    <button id="continue-btn">Continue Last Save</button>
  </section>

  <!-- GAME -->
  <section id="game">
    <h2 id="week-title"></h2>
    <div class="stats">
      <div>WB <div class="progress"><span id="bar-wb"></span></div></div>
      <div>KN <div class="progress"><span id="bar-kn"></span></div></div>
      <div>$ <div class="progress"><span id="bar-mo"></span></div></div>
      <div>SO <div class="progress"><span id="bar-so"></span></div></div>
    </div>
    <small>WB: Wellbeing | KN: Knowledge | $: Money | SO: Social</small>
    <p id="objective"><strong>Objective:</strong> Maintain Wellbeing ≥ 60 by the end of semester.</p>
    <h3 id="event-title"></h3>
    <p id="event-text"></p>
    <div id="choices"></div>
    <p id="tip"></p>
    <p id="log"></p>
  </section>

  <!-- RESULTS -->
  <section id="results">
    <h2 id="ending-title"></h2>
    <canvas id="chart" width="300" height="300"></canvas>
    <p id="ending-summary"></p>
    <p>Resources: <br>
      <a href="https://www.lifeline.org.au/" target="_blank">Lifeline</a> | 
      <a href="https://www.beyondblue.org.au/" target="_blank">Beyond Blue</a> | 
      <a href="https://www.rmit.edu.au/students/support-and-facilities/student-support/counselling" target="_blank">RMIT Counselling</a>
    </p>
    <button id="restart-btn">Restart</button>
    <button id="menu-btn">Menu</button>
  </section>
</main>

<!-- MODALS -->
<div id="modal-5w">
  <div class="modal-content">
    <h3>Weekly Reflection</h3>
    <canvas id="bar5" width="250" height="150"></canvas>
    <p id="w5-msg"></p>
    <button id="w5-continue">Continue</button>
  </div>
</div>

<div id="journal-modal">
  <div class="modal-content">
    <h3>End of Semester Reflection</h3>
    <p>How did this semester feel for you?</p>
    <button class="feel-btn" data-feel="Grateful">Grateful</button>
    <button class="feel-btn" data-feel="Tired">Tired</button>
    <button class="feel-btn" data-feel="Balanced">Balanced</button>
    <button class="feel-btn" data-feel="Motivated">Motivated</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<footer>© 2025 The Trinity — RMIT City Campus</footer>

<script>
/* =====================================================
   UNI LIFE SIMULATOR — FINALIST EDITION (patched build)
   ===================================================== */

/* ---------- Utility + Globals ---------- */
const $=s=>document.querySelector(s);
const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
const rnd=a=>a[(Math.random()*a.length)|0];
const MAX_WEEKS=15;
let mindfulMode=false;
const state={week:1,wb:70,kn:50,mo:50,so:50,finished:false,
  eventHistory:[],deltaHistory:[],feelings:''};

/* ---------- Audio System ---------- */
const AudioSys=(()=>{
  const ctx=new (window.AudioContext||window.webkitAudioContext)();
  let volNode=ctx.createGain();volNode.connect(ctx.destination);volNode.gain.value=0.03;
  function beep(freq=440,dur=0.1,type='sine',vol=0.04){
    const o=ctx.createOscillator(),g=ctx.createGain();o.type=type;o.frequency.value=freq;
    g.gain.value=vol;o.connect(g).connect(ctx.destination);o.start();
    g.gain.exponentialRampToValueAtTime(.0001,ctx.currentTime+dur);o.stop(ctx.currentTime+dur+.02);}
  const click=()=>beep(600,0.08,'sine',.04);
  const good =()=>beep(740,0.12,'triangle',.04);
  const bad  =()=>beep(300,0.16,'sawtooth',.035);
  function startTone(f,v){const o=ctx.createOscillator(),g=ctx.createGain();g.gain.value=v;
    o.type='sine';o.frequency.value=f;o.connect(g).connect(ctx.destination);o.start();
    setTimeout(()=>{o.stop();},2000);}
  function updateAmbience(){
    if(state.wb>=70){startTone(180,.02);startTone(880,.015);}
    else if(state.wb<40){startTone(120,.03);}
    else{startTone(200,.02);}
  }
  ["click","keydown","touchstart"].forEach(ev=>
    document.addEventListener(ev,()=>{if(ctx.state==="suspended")ctx.resume();},{once:true,passive:true}));
  return{click,good,bad,updateAmbience};
})();

/* ---------- Events ---------- */
const EVENTS=[
 {title:"Orientation Week",text:"Your first week at RMIT City! How do you spend it?",
  options:[
   {label:"Join a club event",delta:{wb:+4,kn:0,mo:-5,so:+8},tip:"Connections energise you."},
   {label:"Study ahead",delta:{wb:-3,kn:+7,mo:0,so:-2},tip:"Discipline helps but balance matters."},
   {label:"Rest and adjust",delta:{wb:+6,kn:-2,mo:0,so:+1},tip:"Recovery is productive too."}
  ]},
 {title:"Assignment Load",text:"Three assignments due next week!",
  options:[
   {label:"Pull an all-nighter",delta:{wb:-8,kn:+6,mo:0,so:-3},tip:"Sleep debt harms focus."},
   {label:"Plan a schedule",delta:{wb:+2,kn:+3,mo:0,so:+1},tip:"Structure reduces stress."},
   {label:"Ask friends for help",delta:{wb:+3,kn:+2,mo:0,so:+4},tip:"Teamwork builds resilience."}
  ]},
];
/* ---------- More Events (continued) ---------- */
EVENTS.push(
 {title:"Heatwave Week",text:"Melbourne hits 39°C and your room feels like an oven.",
  options:[
   {label:"Go study in the library (air-con!)",delta:{wb:+4,kn:+3,mo:-2,so:0},tip:"Smart move."},
   {label:"Stay home and tough it out",delta:{wb:-5,kn:+1,mo:0,so:0},tip:"Hydration is key."},
   {label:"Go to the beach with friends",delta:{wb:+6,kn:-2,mo:-5,so:+6},tip:"Social recovery counts."}
 ]},
 {title:"Part-time Job",text:"Your boss offers extra shifts this weekend.",
  options:[
   {label:"Accept all shifts",delta:{wb:-4,kn:-1,mo:+10,so:-1},tip:"Cash helps, but rest matters."},
   {label:"Decline politely",delta:{wb:+2,kn:0,mo:-4,so:0},tip:"Boundaries protect wellbeing."},
   {label:"Take one shift",delta:{wb:+1,kn:0,mo:+5,so:0},tip:"Balance feels right."}
 ]},
 {title:"Tram Delay",text:"The 19-tram stops mid-Swanston St.",
  options:[
   {label:"Chat with another student",delta:{wb:+1,kn:0,mo:0,so:+3},tip:"Mini social wins."},
   {label:"Scroll TikTok",delta:{wb:0,kn:-1,mo:0,so:0},tip:"Mindful breaks > doom-scrolling."},
   {label:"Read lecture notes",delta:{wb:-1,kn:+2,mo:0,so:0},tip:"Small gains add up."}
 ]},
 {title:"Study Group",text:"Friends invite you to a group study at RMIT Library.",
  options:[
   {label:"Join and contribute",delta:{wb:+2,kn:+4,mo:0,so:+4},tip:"Learning together boosts recall."},
   {label:"Skip and study solo",delta:{wb:-2,kn:+3,mo:0,so:-3},tip:"Isolation can drain energy."},
   {label:"Bring snacks for everyone",delta:{wb:+3,kn:+1,mo:-2,so:+5},tip:"Kindness pays off."}
 ]}
);

/* ---------- Rendering ---------- */
function updateHUD(){
 $('#bar-wb').style.width=state.wb+'%';
 $('#bar-kn').style.width=state.kn+'%';
 $('#bar-mo').style.width=state.mo+'%';
 $('#bar-so').style.width=state.so+'%';
 $('#week-title').textContent=`Week ${state.week}/15`;
}
function renderEventByIndex(i){
 const e=EVENTS[i];
 $('#event-title').textContent=e.title;
 $('#event-text').textContent=e.text;
 const c=$('#choices'); c.innerHTML='';
 e.options.forEach((opt,idx)=>{
   const b=document.createElement('button');
   b.textContent=opt.label;
   b.onclick=()=>applyChoice(opt);
   c.appendChild(b);
 });
}
function pickEventIndex(){
 // Avoid repeats & enable dynamic difficulty
 let pool=EVENTS.map((_,i)=>i).filter(i=>!state.eventHistory.includes(i));
 if(!pool.length) state.eventHistory=[];
 pool=EVENTS.map((_,i)=>!state.eventHistory.includes(i)?i:null).filter(x=>x!==null);
 // Dynamic bias
 if(state.wb<30) pool.push(0);
 if(state.kn<40) pool.push(1);
 if(state.mo<25) pool.push(3);
 if(state.so<30) pool.push(2);
 let i=rnd(pool);
 if(i===state.lastEventIdx) i=rnd(pool);
 state.lastEventIdx=i; state.eventHistory.push(i);
 return i;
}

/* ---------- Apply Choice ---------- */
function applyChoice(opt){
 AudioSys.click();
 const d=opt.delta;
 const old={wb:state.wb,kn:state.kn,mo:state.mo,so:state.so};
 state.wb=clamp(state.wb+d.wb,0,100);
 state.kn=clamp(state.kn+d.kn,0,100);
 state.mo=clamp(state.mo+d.mo,0,100);
 state.so=clamp(state.so+d.so,0,100);
 state.deltaHistory.push(d);
 updateHUD();
 showToast(d);
 $('#tip').textContent=opt.tip;
 if(state.week%5===0 && state.week<MAX_WEEKS) open5WReflection();
 else advanceWeek();
}

/* ---------- Toast Feedback ---------- */
function showToast(delta){
 const t=$('#toast');
 const pos=rnd([
  "You feel calmer after setting boundaries.",
  "Your social battery feels recharged.",
  "It feels good to make steady progress.",
  "Small steps matter today."
 ]);
 t.textContent=pos;
 t.classList.add('show');
 setTimeout(()=>t.classList.remove('show'),2500);
}

/* ---------- Advance Week ---------- */
function advanceWeek(){
 state.week++;
 if(state.week>MAX_WEEKS){openJournal();return;}
 const idx=pickEventIndex();
 renderEventByIndex(idx);
 AudioSys.updateAmbience();
}

/* ---------- 5-Week Reflection ---------- */
function open5WReflection(){
 const modal=$('#modal-5w');
 const slice=state.deltaHistory.slice(-5);
 const sums=slice.reduce((a,d)=>({wb:a.wb+d.wb,kn:a.kn+d.kn,mo:a.mo+d.mo,so:a.so+d.so}),{wb:0,kn:0,mo:0,so:0});
 const avg={wb:slice.length?Math.round(sums.wb/slice.length):0,
            kn:slice.length?Math.round(sums.kn/slice.length):0,
            mo:slice.length?Math.round(sums.mo/slice.length):0,
            so:slice.length?Math.round(sums.so/slice.length):0};
 drawBars(avg);
 $('#w5-msg').textContent=avg.kn>avg.wb?
   "You’ve made steady growth in Knowledge but seem more drained — remember to rest."
   :"Nice balance emerging — keep small recovery habits.";
 modal.classList.add('show');
 $('#w5-continue').onclick=()=>{
   modal.classList.remove('show');
   if(state.week<MAX_WEEKS){
     state.week++;
     updateHUD();
     const idx=pickEventIndex();
     renderEventByIndex(idx);
   } else openJournal();
 };
}

/* ---------- Draw 5-Week Bar ---------- */
function drawBars(avg){
 const ctx=$('#bar5').getContext('2d');
 ctx.clearRect(0,0,250,150);
 const labels=['WB','KN','$','SO'],vals=[avg.wb,avg.kn,avg.mo,avg.so];
 vals.forEach((v,i)=>{
   ctx.fillStyle=v>=0?'#16a34a':'#ef4444';
   ctx.fillRect(30+i*50,120-Math.abs(v),30,Math.abs(v));
   ctx.fillStyle='#000';ctx.fillText(labels[i],35+i*50,140);
 });
}

/* ---------- Journal / End ---------- */
function openJournal(){
 $('#journal-modal').classList.add('show');
 document.querySelectorAll('.feel-btn').forEach(btn=>{
  btn.onclick=()=>{
    state.feelings=btn.dataset.feel;
    $('#journal-modal').classList.remove('show');
    showResults();
  };
 });
}
function showResults(){
 $('#game').style.display='none';
 $('#results').style.display='block';
 const avg=(state.wb+state.kn+state.mo+state.so)/4;
 let title='Balanced Success';
 if(state.wb<40)title='Burnout';
 else if(state.mo<30)title='Financial Strain';
 else if(state.so<30)title='Isolation';
 $('#ending-title').textContent=title;
 $('#ending-summary').textContent=
   `You completed the semester feeling ${state.feelings}. `+
   `Average balance: ${avg.toFixed(0)}%. Remember, real success is staying kind to yourself.`;
 drawRadar();
}

/* ---------- Radar Chart ---------- */
function drawRadar(){
 const c=$('#chart');const ctx=c.getContext('2d');const cx=150,cy=150,r=80;
 ctx.clearRect(0,0,300,300);ctx.strokeStyle='#aaa';ctx.beginPath();
 const vals=[state.wb,state.kn,state.mo,state.so];
 for(let i=0;i<4;i++){
   const ang=(Math.PI/2)*i-Math.PI/4;
   const x=cx+r*Math.cos(ang),y=cy+r*Math.sin(ang);
   if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);
 }ctx.closePath();ctx.stroke();
 ctx.fillStyle='rgba(44,122,123,0.3)';ctx.beginPath();
 for(let i=0;i<4;i++){
   const ang=(Math.PI/2)*i-Math.PI/4;
   const rr=r*(vals[i]/100);
   const x=cx+rr*Math.cos(ang),y=cy+rr*Math.sin(ang);
   if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);
 }ctx.closePath();ctx.fill();
}

/* ---------- Start + Menu ---------- */
function startNew(){
 mindfulMode=$('#mindful-toggle').checked;
 state.week=1;state.wb=70;state.kn=50;state.mo=50;state.so=50;
 state.eventHistory=[];state.deltaHistory=[];
 $('#menu').style.display='none';$('#game').style.display='block';
 updateHUD();renderEventByIndex(pickEventIndex());
 AudioSys.updateAmbience();
}
$('#start-btn').onclick=startNew;
$('#continue-btn').onclick=startNew; // simple restart
$('#restart-btn').onclick=()=>location.reload();
$('#menu-btn').onclick=()=>location.reload();

/* ---------- Init ---------- */
updateHUD();
</script>
</body>
</html>

