<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>UniLife Simulator — RMIT City Finalist Edition</title>
<style>
:root{--bg1:#F5F8FF;--bg2:#DCE2F0;--ink:#0b1d2a;--muted:#5a6b7a;--card:#ffffff;--stroke:#e3e8ef;--accent:#B71C1C;--good:#16a34a;--bad:#ef4444;--mint:#c9f0de;--sky:#cfe9ff}
*{box-sizing:border-box}html,body{height:100%}body{margin:0;font-family:Inter,"Nunito Sans",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink);background:linear-gradient(180deg,var(--bg1),var(--bg2));overflow-x:hidden}
.container{max-width:1100px;margin:0 auto;padding:20px}
h1,h2,h3{margin:0 0 8px}p{margin:0 0 10px}small{color:var(--muted)}
.card{background:var(--card);border:1px solid var(--stroke);border-radius:16px;box-shadow:0 10px 24px rgba(21,37,59,.10)}.panel{padding:16px}.row{display:flex;flex-wrap:wrap;gap:12px}.center{text-align:center}.right{text-align:right}
.btn{border:1px solid var(--stroke);background:linear-gradient(135deg,#f8fbff,#ffffff);padding:10px 14px;border-radius:12px;cursor:pointer;transition:transform .08s ease, box-shadow .2s ease}
.btn:hover{transform:translateY(-1px);box-shadow:0 6px 12px rgba(21,37,59,.12)}.btn:active{transform:translateY(0)}.btn.primary{background:linear-gradient(135deg,#ffe6e6,#ffffff);border:1px solid #f2d4d4}.btn.ghost{background:transparent}
.hud{display:flex;align-items:center;gap:10px;flex-wrap:wrap}.stat{display:flex;align-items:center;gap:8px}.badge{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;background:#f6f8fb;border:1px solid var(--stroke);font-size:13px}.icon{font-size:15px}
.bar{width:160px;height:10px;background:#eef2f7;border-radius:999px;overflow:hidden;border:1px solid var(--stroke)}.bar>span{display:block;height:100%;background:linear-gradient(90deg,#ffd4d4,#ffecec);width:50%;transition:width .3s ease}
.grid{display:grid;grid-template-columns: 1.1fr .9fr;gap:14px}@media (max-width: 900px){ .grid{grid-template-columns:1fr} }
.side{display:flex;flex-direction:column;gap:12px}.legend{font-size:13px;color:var(--muted)}.legend b{color:var(--ink)}
#bg{position:fixed;inset:0;z-index:-1;opacity:.22;pointer-events:none;background:radial-gradient(1200px 800px at 30% 10%, #fff 0%, transparent 60%),linear-gradient(125deg, var(--mint), var(--sky));filter:hue-rotate(0deg);transition:filter .6s ease}
.scene{position:relative;min-height:20px}.scene .tag{position:absolute;right:10px;top:10px;font-size:12px;background:#ffffffb3;border:1px solid var(--stroke);padding:6px 8px;border-radius:10px}
#choices .btn{width:100%;text-align:left}.delta{float:right;font-size:12px}.pos{color:var(--good)}.neg{color:var(--bad)}
#log{height:220px;overflow:auto;background:#f8fbff;border:1px solid var(--stroke);border-radius:12px;padding:10px}
.toast{position:fixed; left:50%; bottom:18px; transform:translateX(-50%); background:#ffffffee; border:1px solid var(--stroke); padding:10px 14px; border-radius:12px; opacity:0; transition:opacity .3s ease, transform .3s ease; z-index:60}
.toast.show{opacity:1; transform:translateX(-50%) translateY(-4px)}
.modal{ position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; align-items:center; justify-content:center; z-index:50}
.modal.show{display:flex}.modal .box{ background:#fff; border:1px solid var(--stroke); border-radius:16px; padding:18px; max-width:720px; width:92% }
kbd{background:#f5f7fa;border:1px solid var(--stroke);border-bottom-width:2px;border-radius:6px;padding:2px 6px}
footer{margin-top:18px;color:var(--muted);font-size:13px}footer a{color:var(--muted)}
.fade-in{animation:fade .35s ease both}@keyframes fade{from{opacity:0; transform:translateY(4px)} to{opacity:1; transform:none}}
#confetti{position:fixed; inset:0; pointer-events:none; display:none; z-index:80}
.tooltip{position:relative; cursor:help}.tooltip .tip{position:absolute; left:0; bottom:120%; background:#0b1d2a; color:#fff; padding:6px 8px; border-radius:8px; font-size:12px; white-space:nowrap; opacity:0; transform:translateY(6px); transition:.2s; pointer-events:none}
.tooltip:focus .tip,.tooltip:hover .tip{opacity:1; transform:translateY(0)}
.quote{font-style:italic; color:#314456}.mood{font-size:20px}
</style>
</head>
<body>
<div id="bg" aria-hidden="true"></div>
<canvas id="confetti"></canvas>
<div class="container">
  <header class="card panel row" style="align-items:center; justify-content:space-between">
    <div><h1>UniLife Simulator — RMIT City <span style="font-size:14px; color:#b34">Finalist Edition</span></h1><small>Front‑end only • 15 Weeks • Balance ❤️/📚/💸/🤝 • No backend</small></div>
    <div class="badge"><span class="icon">🎯</span> Aim: Keep <b>WB ≥ 60</b> by Week 15</div>
  </header>

  <main id="view-menu" class="card panel fade-in">
    <div class="row">
      <section class="panel" style="flex:1 1 560px">
        <h2>Start your semester</h2>
        <div class="row">
          <label style="flex:1 1 200px">Name<br><input id="name" style="width:100%"></label>
          <label style="flex:1 1 200px">Major<br><select id="major" style="width:100%"><option>General</option><option>Engineering</option><option>Health</option><option>Business</option></select></label>
          <label style="flex:1 1 200px">Pronouns<br><select id="pronouns" style="width:100%"><option>they/them</option><option>she/her</option><option>he/him</option></select></label>
        </div>
        <div class="row" style="margin-top:10px"><label class="badge"><input type="checkbox" id="mindful"> Mindful Mode</label><span class="badge">Shortcuts: <kbd>1–4</kbd> choose • <kbd>S</kbd> save</span></div>
        <div class="row" style="margin-top:12px"><button class="btn primary" id="start">Start Semester</button><button class="btn" id="resume">Continue Last Save</button></div>
      </section>
      <aside class="card panel" style="flex:1 1 320px">
        <h3>How it works</h3>
        <p class="legend">Each turn = <b>1 week</b> (total 15). Choose from <b>3–4 options</b> per event; your stats change and affect the ending.</p>
        <p class="legend">Everything runs <b>offline</b> in your browser — no data leaves your device.</p>
        <p class="legend">Tip: pace your energy and protect your sleep!</p>
      </aside>
    </div>
  </main>

  <section id="view-play" class="card panel" style="display:none">
    <div class="row hud">
      <div class="badge">Week <b id="week">1</b>/15</div>
      <div class="stat tooltip" tabindex="0" aria-label="Wellbeing: manage stress, recovery, and rest"><span class="icon">❤️</span><div class="bar" aria-hidden="true"><span id="wb-bar"></span></div><span id="wb-num" aria-live="polite">70</span><span class="tip">WB: Wellbeing — manage stress & rest</span></div>
      <div class="stat tooltip" tabindex="0" aria-label="Knowledge: study progress and mastery"><span class="icon">📚</span><div class="bar"><span id="kn-bar"></span></div><span id="kn-num">40</span><span class="tip">KN: Knowledge — study progress</span></div>
      <div class="stat tooltip" tabindex="0" aria-label="Money: budget and work"><span class="icon">💸</span><div class="bar"><span id="mo-bar"></span></div><span id="mo-num">50</span><span class="tip">$: Money — budget & work</span></div>
      <div class="stat tooltip" tabindex="0" aria-label="Social: connection and belonging"><span class="icon">🤝</span><div class="bar"><span id="so-bar"></span></div><span id="so-num">40</span><span class="tip">SO: Social — connection</span></div>
      <span class="badge" id="mood">Mood: 😊</span>
      <button class="btn" id="save">💾 Save</button><button class="btn ghost" id="end">End Early</button>
    </div>
    <div class="grid" style="margin-top:10px">
      <article class="card panel">
        <div class="scene"><div class="tag" id="scene-tag">Library</div></div>
        <h3 id="ev-title">Welcome</h3><p id="ev-text" class="legend">Make a choice to set your rhythm.</p>
        <div id="choices" class="row"></div>
        <p id="tip" class="legend"></p><p class="quote" id="quote"></p>
      </article>
      <aside class="panel">
        <div class="card panel"><h4>Objective</h4><p class="legend">Keep <b>Wellbeing ≥ 60</b> by Week 15 while growing knowledge steadily.</p></div>
        <div class="card panel"><h4>Legend</h4><p class="legend">WB = Wellbeing • KN = Knowledge • $ = Money • SO = Social</p><p class="legend">Weekly Trivia: <span id="trivia">—</span></p></div>
        <div class="card panel"><h4>Recent Decisions</h4><div id="log" style="height:220px;overflow:auto;background:#f8fbff;border:1px solid var(--stroke);border-radius:12px;padding:10px"></div></div>
      </aside>
    </div>
  </section>

  <section id="view-results" class="card panel" style="display:none">
    <h2 id="result-title">Semester Summary</h2>
    <p id="result-body" class="legend"></p>
    <canvas id="radar" width="360" height="360" style="max-width:100%"></canvas>
    <div class="row" style="margin-top:10px"><button class="btn" id="download">📄 Download Journey</button><button class="btn primary" id="restart">Play Again</button><button class="btn" id="menu">Back to Menu</button></div>
    <div class="legend" style="margin-top:10px">Help: Lifeline 13 11 14 • Beyond Blue 1300 22 4636 • RMIT Counselling & Wellbeing</div>
  </section>

  <footer class="center">© 2025 The Trinity — RMIT City Campus</footer>
</div>

<div id="modal-5w" class="modal" role="dialog" aria-modal="true" aria-labelledby="w5-title">
  <div class="box"><h3 id="w5-title">5‑Week Reflection</h3><canvas id="bar5" width="420" height="240" style="max-width:100%"></canvas><p id="w5-msg" class="legend center"></p><div class="center" style="margin-top:8px"><button class="btn primary" id="w5-continue">Continue</button></div></div>
</div>
<div id="modal-reflect" class="modal" role="dialog" aria-modal="true" aria-labelledby="r-title">
  <div class="box"><h3 id="r-title">Check‑in</h3><p id="r-body" class="legend"></p><div class="center" style="margin-top:8px"><button class="btn primary" id="r-continue">Continue</button></div></div>
</div>
<div id="modal-journal" class="modal" role="dialog" aria-modal="true" aria-labelledby="j-title">
  <div class="box"><h3 id="j-title">Final Reflection</h3><p class="legend">Pick a sentence that fits your term’s lesson:</p>
    <div class="row center"><button class="btn" data-j="Small daily recovery beats last-minute rescue.">Small daily recovery beats last-minute rescue.</button><button class="btn" data-j="Balance isn’t perfection — it’s pacing and support.">Balance isn’t perfection — it’s pacing and support.</button><button class="btn" data-j="Connection fuels learning more than isolation.">Connection fuels learning more than isolation.</button><button class="btn" data-j="Boundaries at work protect my study and sleep.">Boundaries at work protect my study and sleep.</button></div>
  </div>
</div>

<div id="toast" class="toast" aria-live="polite"></div>

<script>
const $=s=>document.querySelector(s),$$=s=>Array.from(document.querySelectorAll(s)),rnd=a=>a[(Math.random()*a.length)|0],clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
const MAX_WEEKS=15,SAVE_KEY='unilife_finalist_save';let shown7=false,shown14=false;
const bgEl=$('#bg');function moodHue(wb){const hue=wb>=70?8:wb<40?190:110;bgEl.style.filter=`hue-rotate(${hue}deg)`;}
const confettiCanvas=$('#confetti');const ctxConf=confettiCanvas.getContext('2d');function confettiBurst(){confettiCanvas.style.display='block';confettiCanvas.width=innerWidth;confettiCanvas.height=innerHeight;const pieces=Array.from({length:160},_=>({x:Math.random()*innerWidth,y:-10,r:Math.random()*6+2,c:`hsl(${Math.random()*360},90%,60%)`,vy:2+Math.random()*3,vx:(Math.random()-.5)*2}));let t=0;const anim=()=>{ctxConf.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);pieces.forEach(p=>{p.x+=p.vx;p.y+=p.vy;ctxConf.fillStyle=p.c;ctxConf.beginPath();ctxConf.arc(p.x,p.y,p.r,0,Math.PI*2);ctxConf.fill()});if((t+=1)<200)requestAnimationFrame(anim);else confettiCanvas.style.display='none'};anim()}
const AC=window.AudioContext||window.webkitAudioContext;const audio={ctx:null,started:false,gain:null};function ensureAudio(){if(audio.started)return;try{audio.ctx=new AC();audio.gain=audio.ctx.createGain();audio.gain.gain.value=.06;audio.gain.connect(audio.ctx.destination);const o1=audio.ctx.createOscillator(),g1=audio.ctx.createGain();const o2=audio.ctx.createOscillator(),g2=audio.ctx.createGain();g1.gain.value=.02;g2.gain.value=.02;o1.type='sine';o2.type='triangle';o1.frequency.value=180;o2.frequency.value=224;o1.connect(g1).connect(audio.gain);o2.connect(g2).connect(audio.gain);o1.start();o2.start();audio.started=true}catch(e){}}['click','keydown','touchstart'].forEach(ev=>document.addEventListener(ev,()=>{if(AC&&audio.ctx&&audio.ctx.state==='suspended'){audio.ctx.resume()}ensureAudio()},{once:true,passive:true}));
function pip(freq=660,dur=.08,type='sine',vol=.04){if(!audio.ctx)return;const o=audio.ctx.createOscillator(),g=audio.ctx.createGain();o.type=type;o.frequency.value=freq;g.gain.value=vol;o.connect(g).connect(audio.ctx.destination);o.start();g.gain.exponentialRampToValueAtTime(1e-4,audio.ctx.currentTime+dur);o.stop(audio.ctx.currentTime+dur+.02)}
const QUOTES=["Small steps compound over time.","Rest is part of study, not a reward.","Connection fuels motivation.","Boundaries protect your energy.","Hydration and sunlight help more than you think."];
const TRIVIA=["7–9 hours of sleep improves memory consolidation.","Brief daylight supports mood and circadian rhythm.","Even one weekly social contact protects wellbeing.","Hydration improves attention and recall.","Short movement breaks sustain focus."];
const EVENTS=[
 {t:"Week start routine",tag:'selfcare',x:"How do you set your rhythm this week?",o:[{l:"Plan Pomodoro + breaks",d:{wb:+4,kn:+4,mo:0,so:+1},tip:"Intervals support recovery."},{l:"Grind long sessions",d:{wb:-6,kn:+6,mo:0,so:-1},tip:"Overwork harms sleep."},{l:"Coffee with a mate",d:{wb:+3,kn:+1,mo:-2,so:+4},tip:"Connection boosts motivation."}]},
 {t:"Heatwave alert",tag:'selfcare',x:"It’s 37°C with high UV.",o:[{l:"Study indoors + hydrate",d:{wb:+4,kn:+2,mo:0,so:0},tip:"Heat impairs cognition."},{l:"Outdoor cram",d:{wb:-6,kn:+2,mo:0,so:0},tip:"Fatigue risk."},{l:"Short gym session",d:{wb:+3,kn:+1,mo:-1,so:+1},tip:"Light exercise stabilises mood."}]},
 {t:"Group assignment",tag:'study',x:"Split tasks and milestones.",o:[{l:"Define roles & deadlines",d:{wb:+3,kn:+5,mo:0,so:+2},tip:"Clarity lowers stress."},{l:"Let it evolve",d:{wb:-4,kn:+1,mo:0,so:-1},tip:"Chaos → crunch later."},{l:"Volunteer heavy part",d:{wb:-3,kn:+6,mo:0,so:+1},tip:"Mind the load."}]},
 {t:"Part-time shift",tag:'budget',x:"Extra evening shift offered.",o:[{l:"Negotiate different slot",d:{wb:+2,kn:+2,mo:+2,so:0},tip:"Boundaries protect sleep."},{l:"Accept & cut sleep",d:{wb:-7,kn:+2,mo:+5,so:0},tip:"Sleep loss tanks mood."},{l:"Decline this week",d:{wb:+1,kn:+1,mo:0,so:-1},tip:"Long-term wellbeing."}]},
 {t:"Counselling drop-in",tag:'selfcare',x:"Free short consults available.",o:[{l:"Attend 20-min session",d:{wb:+8,kn:0,mo:0,so:+1},tip:"Early support helps."},{l:"Read self-help page",d:{wb:+3,kn:+1,mo:0,so:0},tip:"Psychoeducation helps."},{l:"Skip — no time",d:{wb:-3,kn:+1,mo:0,so:0},tip:"Avoidance backfires."}]},
 {t:"Myki fares",tag:'budget',x:"Transport costs are tight.",o:[{l:"Batch on-campus days",d:{wb:+2,kn:+2,mo:+3,so:0},tip:"Fewer trips lower cost."},{l:"Travel daily",d:{wb:0,kn:+1,mo:-3,so:+1},tip:"Costs add up."},{l:"Study from home",d:{wb:+1,kn:+1,mo:+2,so:-2},tip:"Less social."}]},
 {t:"Exam prep",tag:'study',x:"Two finals are approaching.",o:[{l:"Timetable + breaks",d:{wb:+3,kn:+6,mo:0,so:0},tip:"Structure beats panic."},{l:"All-nighter blitz",d:{wb:-10,kn:+6,mo:0,so:-1},tip:"Crash risk."},{l:"Peer study circle",d:{wb:+3,kn:+5,mo:0,so:+3},tip:"Belonging lifts motivation."}]},
 {t:"Sleep hygiene",tag:'selfcare',x:"It’s late; caffeine tempts.",o:[{l:"Wind-down + water",d:{wb:+4,kn:+1,mo:0,so:0},tip:"Sleep quality compounds."},{l:"Late coffee & scroll",d:{wb:-5,kn:0,mo:0,so:-1},tip:"Disrupts sleep."},{l:"Tea + journaling",d:{wb:+3,kn:+1,mo:0,so:0},tip:"Reflection regulates stress."}]},
 {t:"Inclusion event",tag:'social',x:"Cultural society invites you.",o:[{l:"Attend & connect",d:{wb:+4,kn:+1,mo:-2,so:+5},tip:"Belonging protects health."},{l:"Drop by briefly",d:{wb:+2,kn:+1,mo:-1,so:+2},tip:"Micro-social boosts morale."},{l:"Skip to study",d:{wb:-1,kn:+3,mo:0,so:-2},tip:"Isolation risks burnout."}]},
 {t:"Rent pressure",tag:'budget',x:"Rent increases mid-semester.",o:[{l:"Budget & seek advice",d:{wb:+1,kn:+1,mo:+4,so:0},tip:"Services can help."},{l:"Cut social for savings",d:{wb:-2,kn:+1,mo:+5,so:-4},tip:"Balance cost & connection."},{l:"Ignore for now",d:{wb:-5,kn:0,mo:-3,so:0},tip:"Uncertainty = stress."}]},
 {t:"Building 80 buzz",tag:'social',x:"You pass by RMIT Building 80 — students debate AI ethics.",o:[{l:"Join the chat",d:{wb:+2,kn:+3,mo:0,so:+3},tip:"Intellectual connection energises."},{l:"Listen quietly",d:{wb:+1,kn:+2,mo:0,so:+1},tip:"Low-pressure engagement counts."},{l:"Head to study nook",d:{wb:+1,kn:+2,mo:0,so:0},tip:"Focus time matters too."}]}
];
const S={name:'Alex',major:'General',pronouns:'they/them',week:1,wb:70,kn:40,mo:50,so:40,history:[],lastIdx:-1,deltas:[],journal:'',finished:false};
const numEls={wb:$('#wb-num'),kn:$('#kn-num'),mo:$('#mo-num'),so:$('#so-num')};const barEls={wb:$('#wb-bar'),kn:$('#kn-bar'),mo:$('#mo-bar'),so:$('#so-bar')};
function setBars(){barEls.wb.style.width=S.wb+'%';barEls.kn.style.width=S.kn+'%';barEls.mo.style.width=S.mo+'%';barEls.so.style.width=S.so+'%';numEls.wb.textContent=S.wb;numEls.kn.textContent=S.kn;numEls.mo.textContent=S.mo;numEls.so.textContent=S.so;$('#week').textContent=S.week;$('#mood').textContent='Mood: '+(S.wb>=70?'😊':S.wb<40?'😢':'😐');moodHue(S.wb)}
function show(view){$('#view-menu').style.display=view==='menu'?'block':'none';$('#view-play').style.display=view==='play'?'block':'none';$('#view-results').style.display=view==='results'?'block':'none'}
function addLog(html){const p=document.createElement('p');p.innerHTML=html;$('#log').prepend(p)}
function toast(msg){const t=$('#toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2200)}
function pickEventIndex(){const used=new Set(S.history);let pool=EVENTS.map((_,i)=>i).filter(i=>!used.has(i));if(!pool.length){S.history=[];pool=EVENTS.map((_,i)=>i)}pool=pool.filter(i=>i!==S.lastIdx);if(!pool.length){pool=EVENTS.map((_,i)=>i).filter(i=>i!==S.lastIdx)}const weights=pool.map(i=>{const tag=EVENTS[i].tag;let w=1;if(S.wb<30&&tag==='selfcare')w+=2.5;if(S.kn<40&&tag==='study')w+=2;if(S.mo<25&&tag==='budget')w+=2;if(S.so<30&&tag==='social')w+=2;return w});const sum=weights.reduce((a,b)=>a+b,0);let r=Math.random()*sum;for(let k=0;k<pool.length;k++){r-=weights[k];if(r<=0)return pool[k]}return pool[0]}
function renderEvent(i){S.lastIdx=i;const ev=EVENTS[i];$('#scene-tag').textContent=rnd(['Library','Tram','Rooftop','Café','Dorm']);$('#ev-title').textContent=ev.t;$('#ev-text').textContent=ev.x;$('#quote').textContent=rnd(QUOTES);$('#trivia').textContent=rnd(TRIVIA);const wrap=$('#choices');wrap.innerHTML='';ev.o.forEach((opt,ix)=>{const d=opt.d,delta=`WB <span class="${d.wb>=0?'pos':'neg'}">${d.wb>=0?'+':''}${d.wb}</span> • KN <span class="${d.kn>=0?'pos':'neg'}">${d.kn>=0?'+':''}${d.kn}</span> • $ <span class="${d.mo>=0?'pos':'neg'}">${d.mo>=0?'+':''}${d.mo}</span> • SO <span class="${d.so>=0?'pos':'neg'}">${d.so>=0?'+':''}${d.so}</span>`;const b=document.createElement('button');b.className='btn fade-in';b.innerHTML=`<b>${String.fromCharCode(65+ix)}) ${opt.l}</b> <span class="delta">${delta}</span>`;b.addEventListener('click',()=>{$$('#choices .btn').forEach(x=>x.disabled=true);applyChoice(opt);setTimeout(()=>{$$('#choices .btn').forEach(x=>x.disabled=false)},280)});wrap.appendChild(b)});$('#tip').textContent=''}
function applyChoice(opt){pip(520,.06,'sine',.035);const d=opt.d;S.wb=clamp(S.wb+(d.wb||0),0,100);S.kn=clamp(S.kn+(d.kn||0),0,100);S.mo=clamp(S.mo+(d.mo||0),0,100);S.so=clamp(S.so+(d.so||0),0,100);setBars();addLog(`${opt.l} → WB <span class="${d.wb>=0?'pos':'neg'}">${d.wb>=0?'+':''}${d.wb}</span> • KN <span class="${d.kn>=0?'pos':'neg'}">${d.kn>=0?'+':''}${d.kn}</span> • $ <span class="${d.mo>=0?'pos':'neg'}">${d.mo>=0?'+':''}${d.mo}</span> • SO <span class="${d.so>=0?'pos':'neg'}">${d.so>=0?'+':''}${d.so}</span>`);$('#tip').textContent='Tip: '+(opt.tip||'');S.deltas.push({wb:opt.d.wb||0,kn:opt.d.kn||0,mo:opt.d.mo||0,so:opt.d.so||0});toast(rnd(["You feel calmer after setting boundaries.","Your social battery feels recharged.","Steady progress feels good.","Nice pacing — keep it steady."]));if(S.week%5===0&&S.week<MAX_WEEKS){open5W();return}if(S.week===7&&!shown7){openReflect("Mid‑Semester Check‑In");shown7=true;return}if(S.week===14&&!shown14){openReflect("Second Wind Check‑In");shown14=true;return}advance();save()}
function advance(){if(S.lastIdx!==-1&&!S.history.includes(S.lastIdx)){S.history.push(S.lastIdx)}if(S.week>=MAX_WEEKS){openJournal();return}S.week+=1;setBars();renderEvent(pickEventIndex())}
function open5W(){const m=$('#modal-5w');const slice=S.deltas.slice(-5);const sums=slice.reduce((a,d)=>({wb:a.wb+d.wb,kn:a.kn+d.kn,mo:a.mo+d.mo,so:a.so+d.so}),{wb:0,kn:0,mo:0,so:0});const avg={wb:slice.length?Math.round(sums.wb/slice.length):0,kn:slice.length?Math.round(sums.kn/slice.length):0,mo:slice.length?Math.round(sums.mo/slice.length):0,so:slice.length?Math.round(sums.so/slice.length):0};drawBars(avg);$('#w5-msg').textContent=avg.kn>avg.wb?"Knowledge is rising — remember to rest.":"Nice balance — keep tiny resets.";m.classList.add('show');$('#w5-continue').onclick=()=>{m.classList.remove('show');if(S.week<MAX_WEEKS){S.week+=1;setBars();renderEvent(pickEventIndex());save()}else openJournal()}} 
function drawBars(avg){const c=$('#bar5'),x=c.getContext('2d');x.clearRect(0,0,c.width,c.height);const labels=['WB','KN','$','SO'],vals=[avg.wb,avg.kn,avg.mo,avg.so];x.font='12px system-ui';x.fillStyle='#2a3c4d';for(let i=0;i<4;i++){const v=vals[i],x0=40+i*90;x.fillStyle='#eef3f9';x.fillRect(x0,180,60,-120);x.fillStyle=v>=0?'#16a34a':'#ef4444';const h=Math.min(120,Math.abs(v));x.fillRect(x0,180,60,-Math.sign(v)*h);x.fillStyle='#314456';x.textAlign='center';x.fillText(labels[i],x0+30,198);x.fillText((v>=0?'+':'')+v,x0+30,54)}}
function openReflect(title){const m=$('#modal-reflect');$('#r-title').textContent=title;const strongest=[['Wellbeing',S.wb],['Knowledge',S.kn],['Money',S.mo],['Social',S.so]].sort((a,b)=>b[1]-a[1])[0][0];const weakest=[['Wellbeing',S.wb],['Knowledge',S.kn],['Money',S.mo],['Social',S.so]].sort((a,b)=>a[1]-b[1])[0][0];$('#r-body').textContent=`Your strength is ${strongest}. Lowest is ${weakest}. Gentle adjustments can help.`;m.classList.add('show');$('#r-continue').onclick=()=>{m.classList.remove('show');advance();save()}}
function openJournal(){const m=$('#modal-journal');m.classList.add('show');$$('#modal-journal [data-j]').forEach(b=>b.onclick=()=>{S.journal=b.dataset.j;m.classList.remove('show');endGame()})}
function drawRadar(wb,kn,mo,so){const c=$('#radar'),x=c.getContext('2d'),W=c.width,H=c.height,cx=W/2,cy=H/2,r=Math.min(W,H)/2-28;x.clearRect(0,0,W,H);x.strokeStyle='#e3e8ef';for(let i=1;i<=3;i++){x.beginPath();x.arc(cx,cy,(r*i)/3,0,Math.PI*2);x.stroke()}const labs=['WB','KN','$','SO'];x.fillStyle='#314456';x.font='12px system-ui';for(let i=0;i<4;i++){const a=(-Math.PI/2)+(i*Math.PI/2),ex=cx+Math.cos(a)*r,ey=cy+Math.sin(a)*r;x.beginPath();x.moveTo(cx,cy);x.lineTo(ex,ey);x.stroke();x.textAlign='center';x.fillText(labs[i],ex,ey+(i===0?-12:12))}const vals=[wb,kn,mo,so].map(v=>clamp(v,0,100));x.beginPath();for(let i=0;i<4;i++){const a=(-Math.PI/2)+(i*Math.PI/2),pr=r*(vals[i]/100),px=cx+Math.cos(a)*pr,py=cy+Math.sin(a)*pr;i?x.lineTo(px,py):x.moveTo(px,py)}x.closePath();x.fillStyle='rgba(183,28,28,.25)';x.fill();x.lineWidth=2;x.strokeStyle='rgba(183,28,28,.65)';x.stroke()}
function endGame(){show('results');const {wb,kn,mo,so}=S;let title='Solid Pass ✅',body=`WB ${wb}, KN ${kn}, $ ${mo}, SO ${so}.`;if(wb<40)title="Burnout Warning 😵";else if(mo<25)title="Financial Strain 💸";else if(kn>=70&&wb<60)title="Grades at a Cost 📚";else if(wb>=70&&kn>=60&&mo>=35&&so>=35)title="Balanced Success 🎓";$('#result-title').textContent=title;$('#result-body').textContent=body+(S.journal?" Reflection: "+S.journal:"");drawRadar(wb,kn,mo,so);confettiBurst();localStorage.removeItem(SAVE_KEY)}
function save(){localStorage.setItem(SAVE_KEY,JSON.stringify(S))}
function load(){try{const raw=localStorage.getItem(SAVE_KEY);if(!raw)return false;Object.assign(S,JSON.parse(raw));return true}catch(e){return false}}
function startNew(){S.name=$('#name').value||'Alex';S.major=$('#major').value;S.pronouns=$('#pronouns').value;S.week=1;S.wb=70;S.kn=40;S.mo=50;S.so=40;S.history=[];S.deltas=[];S.lastIdx=-1;S.journal='';S.finished=false;shown7=false;shown14=false;if(S.major==='Engineering'){S.kn+=8;S.wb-=5}if(S.major==='Health'){S.wb+=8;S.mo-=6}if(S.major==='Business'){S.mo+=8;S.so+=4}show('play');setBars();renderEvent(pickEventIndex());save()}
$('#start').onclick=startNew;$('#resume').onclick=()=>{if(load()){show('play');setBars();renderEvent(pickEventIndex())}else startNew()};$('#save').onclick=()=>{save();addLog('<span class="pos">Progress saved.</span>')};$('#end').onclick=()=>openJournal();$('#restart').onclick=()=>show('menu');$('#menu').onclick=()=>show('menu');$('#download').onclick=()=>{const txt=`UniLife — Summary\nName: ${S.name}\nFinal WB ${S.wb} KN ${S.kn} $ ${S.mo} SO ${S.so}\nReflection: ${S.journal||'-'}`;const blob=new Blob([txt],{type:'text/plain'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='unilife_summary.txt';a.click();URL.revokeObjectURL(url)}
document.addEventListener('keydown',e=>{if($('#view-play').style.display!=='block')return;const map={'1':0,'2':1,'3':2,'4':3};if(map[e.key]!=null){const btn=$$('#choices .btn')[map[e.key]];if(btn)btn.click()}if(e.key.toLowerCase()==='s')$('#save').click()});
setBars();show('menu');renderEvent(0);
</script>
</body></html>
